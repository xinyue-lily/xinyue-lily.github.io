---
layout: post
title: Blog Post 2
---



2022-01-31

[https://github.com/xinyue-lily/Blog-Post/tree/main/blogpost2](https://github.com/xinyue-lily/Blog-Post/tree/main/blogpost2)

the above is the link to my github respository. 


## 1. Separate code blocks and explanations for each of the python functions

We write three python functions for database management in a file app.py.

a)	We define get_message_db () to handle creating the database of messages.

(1)	Firstly, we check whether there is a database called message_db in the g attribute of the app. If not, then connect to that database.

(2) We check whether a table called messages exists in message_db, if there is no table available, we create the table messages with three columns: ID as an integer, handle as text, and message as text.

(3)return the connection g.message_db.

```python
def get_message_db():
    g.message_db = sqlite3.connect("message_db.sqite") 
    cursor = g.message_db.cursor()
    #if there is no table available, we create a new table with three 
    #columns: Id as an integer, handle as text, and message as text.
    cursor.execute("create table if not exists messages(Id integer, 
                    handle text, message text)")
    cursor.close()
    return g.message_db
```

b)	The second function we created is called insert_message() which should handle inserting a user message into the database of messages.

(1) We extract the message and the handle from request if they exist. We should ensure submit.html template creates these fields from user input. 

(2) Then we connect the database using cursor.

(3) To ensure that the ID number of each message is unique, we set the ID number equal to one plus the current number of rows.

(4) Write a SQL command in a string called g.sql with variable input value, then perform the insertion with cursor.exectute(g.sql).

(5) Run db.commit() to ensure the row insertion has been saved.

```python
def insert_message(request):
    get_message_db()
    message = request.form['message']
    handle = request.form['user']
    #if both message and handle exists,we store them into a database
    if (message and handle):
        cursor = g.message_db.cursor()
        cursor.execute("select count(*) from messages")
        #To ensure that the ID number of each message is unique, 
        #firstly, I got the current number of rows in message_db.
        #Then we set the ID number equal to one plus the current 
        #number of rows.
        result = cursor.fetchone()[0]+1
        #Lastly we insert the message into table messages.
        g.sql = """insert into messages(Id,handle,message) 
                values(%d,'%s','%s')""" % (result, handle, message)
        cursor.execute(g.sql)
        g.message_db.commit()
        cursor.close()
        g.message_db.close()
    
```

c)	The third function we created is random_messages(n), which fetches n random messages from the message_db.

(1)	We connect the database using cursor.

(2)	Execute sql command to extract the message from message database in random order.

(3) Get n rows from the result.

(4)	Close the cursor and the database.

(5)	Return the result.

```python
#We define a function that fetches our data randomly 
def random_messages(n):
    g.message_db = sqlite3.connect("message_db.sqite") 
    cursor = g.message_db.cursor()
    #Fetch message, handle from table randomly.
    cursor.execute("select message,handle from messages ORDER BY RANDOM()") 
    #get n rows 
    result = cursor.fetchmany(n)
    cursor.close()
    g.message_db.close()
    return result
```

d)	This is the fourth function I created. The function is straightforward, as it gives us the main page of the Webapp.
I put navigation links(insert and view links at the top of the screen) inside a template called base.html provided by the professor. Then I had the main.html, submit.html, insert.html templates extend base.html.

```
# Create main page (fancy)
@app.route('/')
def main():
     return render_template("main.html")

```

e)	The fifth function we created is called view (). The function creates a viewable webpage. 

(1)	Call the template view.html and fetch the number of messages from the data we inputted.

(2)	We will fetch a function called random_messges(n) from db_app.py to pick n messages from the database randomly.

(3)	If we submitted nothing, the program outputs error.

```python
@app.route('/view/', methods=['POST', 'GET'])
def view():
    if request.method == 'GET':
        #we call the template view.html
        return render_template('view.html')
    else:
        try:
            #we fetch the number of messages from the data inputed
            n = int(request.form['number'])
            #we randomly pick n messages from the database
            g.result = db_app.random_messages(n)
            return render_template('view.html',number = request.form['number'])
        except:
            return render_template('view.html',number="error")

```

f)	The last function we defined is called submit ().

(1)	From template submit.html, we extract handle and message from user input.

(2)	If they exist, we will fetch a function called insert_message from db_app.py.

(3)	The insert_message () function will insert a user message into the database of messages.

```python
@app.route('/submit/', methods=['POST', 'GET'])
def submit():
    if request.method == 'GET':
        return render_template('submit.html')
    else:
        try:
            #fetch a function called insert_message from db_app.py. 
            #This we will discuss in later parts of this blog post.
            db_app.insert_message(request)
            return render_template('submit.html', user=request.form['user'],
                                   message=request.form['message'])
        except:
            return render_template('submit.html', user='error', 
                                   message='error')

```




## 2. Discussion of a template file I created in my app

I choose to discuss the template file view.html. The file view.html presents us with the random messages chosen if we click on a button.

(1)	First, we display the line of text “please input how many messages do you want to view (1-5)?” on the website.

(2)	Then we design the style of the input so that the number has a particular size and is in Arial. 

(3)	We also restrict the number input to be from 1 to 5.

All in all, we create a header, tell the user to submit some interesting message, and finish the html by giving some font and size.

```html
{%raw%}
{% block header %}
  <h1>{% block title %}View{% endblock %}</h1>
{% endblock %}

{% block content %}
  <form method="post">
    #we display the line of text "Please input how many messages do you want
    to view (1-5)?" on the website.
    <div style="text-align:center;"><label for="number">Please input how many messages do you want to view(1-5)?</label>
      #we design the style of the input so that the number has a particular 
      #size and is in Arial
      #we also restrict the number input to be from 1 to 5
      <input style="width:80px;height:30px;font:Arial;font-size:18px" 
      type=number name="number" id="number" placeholder="1 to 5" step="1"> 
      <br><br>
      <input type="submit" name='submit1' id = 'submit1' value="View messages">
    </div>
  </form>
  {% for r in g.result %}
    <br>
    <font size=4>{{r[0]}}</font>
    <br>
    -<i><font size=3>{{r[1]}}</font></i>
    <br>
  {% endfor %}

  {% if error %}
    <br>
    Sorry, user or message is not allowed null,pleae try again!
  {% endif %}
{% endblock %}
{%endraw%}
```
![website-1.png](https://raw.githubusercontent.com/xinyue-lily/xinyue-lily.github.io/master/_includes/website-1.png)

![website-2.png](https://raw.githubusercontent.com/xinyue-lily/xinyue-lily.github.io/master/_includes/website-2.png)

